<div class="meters-view">
  <header class="meters-header">
    <div class="header-content">
      <h1>Счётчики</h1>
      <p>Учет коммунальных услуг</p>
    </div>

    <a mat-stroked-button color="basic" routerLink="../resources" class="manage-btn" matTooltip="Настройка счетчиков">
      <mat-icon>settings</mat-icon>
    </a>
  </header>

  <!-- Month Selector -->
  <div class="month-selector">
    <button mat-icon-button (click)="prevMonth()">
      <mat-icon>chevron_left</mat-icon>
    </button>
    <div class="current-month">
      {{ selectedMonth() | date: 'LLLL yyyy' }}
    </div>
    <button mat-icon-button (click)="nextMonth()">
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  <div class="meters-list-container">
    @if (groupedObjects().length) {
    <mat-accordion class="meters-accordion" multi="false">
      @for (obj of groupedObjects(); track trackObject($index, obj)) {
      <mat-expansion-panel class="object-panel">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <span class="object-name">{{ obj.objectName }}</span>
          </mat-panel-title>
          <mat-panel-description>
            <span class="object-total">{{ obj.totalCost | currencyFormat: obj.currency }}</span>
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="compact-readings-list">
          @for (reading of obj.readings; track reading.id) {
          <div class="compact-reading-item" [routerLink]="['../', reading.id, 'edit']" mat-ripple>
            <div class="reading-icon" [ngClass]="getTypeClass(reading.type)">
              <mat-icon>{{ getIcon(reading.type) }}</mat-icon>
            </div>

            <div class="reading-info">
              <span class="resource-name">{{ reading.resourceName }}</span>
              <span class="consumption-text">{{ formatConsumption(reading) }}</span>
            </div>

            <div class="reading-price">
              @if (reading.cost !== undefined) {
              <span class="cost">{{ reading.cost | currencyFormat: reading.currency }}</span>
              }
            </div>

            <mat-icon class="edit-hint">chevron_right</mat-icon>
          </div>
          }
        </div>
      </mat-expansion-panel>
      }
    </mat-accordion>
    } @else {
    <div class="empty-state">
      <mat-icon>speed</mat-icon>
      <p>Нет показаний за этот месяц</p>
      <span class="hint">Внесите данные или выберите другой месяц</span>
    </div>
    }
  </div>

  <button mat-fab class="fab-main" color="primary" routerLink="../create">
    <mat-icon>add</mat-icon>
  </button>
</div>