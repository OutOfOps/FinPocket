<section class="feature-shell settings-shell">
  <header class="feature-shell__header">
    <span class="tag-chip">Настройки</span>
    <h1 class="feature-shell__title">Персонализация FinPocket</h1>
    <p class="feature-shell__subtitle">
      Выберите оформление, которое соответствует вашему режиму. Тёмная тема вдохновлена Monobank, а светлая сохраняет фирменные
      акценты и контраст.
    </p>
  </header>

  <div class="feature-shell__grid settings-grid">
    <mat-card class="feature-card settings-card">
      <div class="feature-card__accent"></div>
      <mat-card-header>
        <mat-card-title class="feature-card__title">Тема интерфейса</mat-card-title>
        <mat-card-subtitle>Мгновенное переключение и сохранение выбора</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <mat-button-toggle-group
          class="settings-toggle"
          name="theme-toggle"
          [value]="theme()"
          (valueChange)="setTheme($event)"
          aria-label="Переключение темы"
        >
          <mat-button-toggle value="dark">
            <mat-icon>nights_stay</mat-icon>
            Тёмная
          </mat-button-toggle>
          <mat-button-toggle value="light">
            <mat-icon>wb_sunny</mat-icon>
            Светлая
          </mat-button-toggle>
        </mat-button-toggle-group>

        <div class="settings-previews" role="list">
          <button
            type="button"
            class="settings-preview settings-preview--dark"
            [class.active]="theme() === 'dark'"
            (click)="setTheme('dark')"
            aria-label="Применить тёмную тему"
            role="listitem"
          >
            <span>Тёмная тема</span>
          </button>
          <button
            type="button"
            class="settings-preview settings-preview--light"
            [class.active]="theme() === 'light'"
            (click)="setTheme('light')"
            aria-label="Применить светлую тему"
            role="listitem"
          >
            <span>Светлая тема</span>
          </button>
        </div>

        <mat-slide-toggle
          class="settings-slide"
          [checked]="theme() === 'dark'"
          (change)="toggleTheme()"
          aria-label="Переключить тему"
        >
          Запоминать ночной режим
        </mat-slide-toggle>

        <p class="settings-hint">
          Выбор темы синхронизируется между сессиями и применяется к всплывающим окнам Angular Material.
        </p>
      </mat-card-content>
    </mat-card>

    <mat-card class="feature-card settings-card">
      <div class="feature-card__accent"></div>
      <mat-card-header>
        <mat-card-title class="feature-card__title">Валюты FinPocket</mat-card-title>
        <mat-card-subtitle>Управляйте списком валют и валютой по умолчанию</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form class="currency-form" (ngSubmit)="addCurrency()" novalidate>
          <div class="currency-form__fields">
            <label class="currency-field">
              <span>Название валюты</span>
              <input
                type="text"
                name="currencyName"
                [(ngModel)]="newCurrency.name"
                required
                maxlength="48"
                placeholder="Например, Злотый"
              />
            </label>
            <label class="currency-field">
              <span>Код</span>
              <input
                type="text"
                name="currencyCode"
                [(ngModel)]="newCurrency.code"
                required
                maxlength="6"
                placeholder="UAH"
              />
            </label>
            <label class="currency-field">
              <span>Курс к {{ baseCurrency()?.code ?? 'базовой валюте' }}</span>
              <input
                type="number"
                name="currencyRate"
                [(ngModel)]="newCurrency.rate"
                required
                min="0.0001"
                step="0.01"
                placeholder="1.0000"
              />
            </label>
          </div>
          <div class="currency-form__actions">
            <button mat-flat-button color="primary" type="submit" [disabled]="!canAddCurrency()">
              Добавить валюту
            </button>
          </div>
        </form>

        <ul class="currency-list" role="list">
          <li
            class="currency-list__item"
            *ngFor="let currency of currencies(); trackBy: trackCurrency"
            [class.currency-list__item--default]="currency.id === defaultCurrency()"
          >
            <ng-container *ngIf="editingCurrencyId === currency.id; else currencyView">
              <form class="currency-edit" (ngSubmit)="saveCurrencyEdit()" novalidate>
                <div class="currency-edit__fields">
                  <label class="currency-field">
                    <span>Название валюты</span>
                    <input
                      type="text"
                      name="editCurrencyName"
                      [(ngModel)]="editingCurrency.name"
                      required
                      maxlength="48"
                    />
                  </label>
                  <label class="currency-field">
                    <span>Код</span>
                    <input
                      type="text"
                      name="editCurrencyCode"
                      [(ngModel)]="editingCurrency.code"
                      required
                      maxlength="6"
                    />
                  </label>
                  <label class="currency-field">
                    <span>Курс к {{ baseCurrency()?.code ?? 'базовой валюте' }}</span>
                    <input
                      type="number"
                      name="editCurrencyRate"
                      [(ngModel)]="editingCurrency.rate"
                      required
                      min="0.0001"
                      step="0.0001"
                    />
                  </label>
                </div>
                <div class="currency-edit__actions">
                  <button mat-button type="button" (click)="cancelCurrencyEdit()">Отмена</button>
                  <button mat-flat-button color="primary" type="submit" [disabled]="!canSaveCurrencyEdit()">
                    Сохранить
                  </button>
                </div>
              </form>
            </ng-container>
            <ng-template #currencyView>
              <div class="currency-list__row">
              <div class="currency-list__details">
                <strong>{{ currency.name }}</strong>
                <span class="currency-code">{{ currency.code }}</span>
                <span class="currency-rate">
                  1 {{ currency.code }} =
                  {{ getRelativeRate(currency) | number: '1.2-4' }} {{ baseCurrency()?.code ?? currency.code }}
                </span>
              </div>
                <div class="currency-list__actions">
                  <button
                    mat-stroked-button
                    type="button"
                    color="primary"
                    *ngIf="currency.id !== defaultCurrency()"
                    (click)="setDefaultCurrency(currency.id)"
                  >
                    Сделать основной
                  </button>
                  <span class="currency-default" *ngIf="currency.id === defaultCurrency()">
                    <mat-icon aria-hidden="true">star</mat-icon>
                    По умолчанию
                  </span>
                  <button
                    mat-icon-button
                    type="button"
                    aria-label="Редактировать валюту"
                    (click)="startCurrencyEdit(currency)"
                  >
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button
                    mat-icon-button
                    type="button"
                    aria-label="Удалить валюту"
                    (click)="removeCurrency(currency.id)"
                    [disabled]="currency.id === defaultCurrency()"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </div>
              </div>
            </ng-template>
          </li>
        </ul>

        <p class="settings-hint">
          Валюта по умолчанию используется для новых счетов, операций и расчётов. Добавляйте валюты,
          чтобы вести мультивалютный учёт, и указывайте курс относительно {{ baseCurrency()?.code ?? 'базовой валюты' }}.
        </p>
      </mat-card-content>
    </mat-card>

    <mat-card class="feature-card settings-card">
      <div class="feature-card__accent"></div>
      <mat-card-header>
        <mat-card-title class="feature-card__title">Обновлённые иллюстрации</mat-card-title>
        <mat-card-subtitle>Превью карточек и значков подстраиваются под тему</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="settings-illustrations">
          <figure class="settings-illustrations__item settings-illustrations__item--finance">
            <div class="settings-illustrations__mock"></div>
            <figcaption>Финансы</figcaption>
          </figure>
          <figure class="settings-illustrations__item settings-illustrations__item--sync">
            <div class="settings-illustrations__mock"></div>
            <figcaption>Синхронизация</figcaption>
          </figure>
          <figure class="settings-illustrations__item settings-illustrations__item--stats">
            <div class="settings-illustrations__mock"></div>
            <figcaption>Статистика</figcaption>
          </figure>
        </div>
        <p class="settings-hint">
          Макеты карточек и иконок используют те же цветовые токены, что и основной интерфейс — контент выглядит цельно как в
          тёмном, так и в светлом оформлении.
        </p>
      </mat-card-content>
    </mat-card>
  </div>
</section>
