<div class="finance-edit-container">

  <!-- Type Switcher -->
  <div class="type-switcher">
    <button class="type-btn" [class.active]="type() === 'expense'" (click)="setType('expense')"
      mat-ripple>Расход</button>
    <button class="type-btn" [class.active]="type() === 'income'" (click)="setType('income')" mat-ripple>Доход</button>
    <button class="type-btn" [class.active]="type() === 'transfer'" (click)="setType('transfer')"
      mat-ripple>Перевод</button>
  </div>

  <!-- Amount & Currency -->
  <div class="amount-wrapper">
    <div class="currency-selector">
      <select [ngModel]="selectedCurrency()" (ngModelChange)="selectedCurrency.set($event)">
        @for (curr of currencies(); track curr.code) {
        <option [value]="curr.code">{{ curr.code }}</option>
        }
      </select>
      <mat-icon>expand_more</mat-icon>
    </div>

    <input type="number" [ngModel]="amount()" (ngModelChange)="amount.set($event)" placeholder="0" class="amount-input"
      inputmode="decimal" autofocus>
  </div>

  <!-- Transfer Config (If Transfer) -->
  @if (type() === 'transfer') {
  <div class="transfer-config">
    <div class="account-selector">
      <label>Откуда</label>
      <div class="selector-box">
        <mat-icon>account_balance_wallet</mat-icon>
        <mat-select [ngModel]="accountFrom()" (ngModelChange)="accountFrom.set($event)">
          @for (acc of accounts(); track acc.id) {
          <mat-option [value]="acc.name">
            <div class="account-option">
              <mat-icon class="account-option__icon">{{ acc.type === 'bank' ? 'credit_card' : 'payments' }}</mat-icon>
              <div class="account-option__info">
                <span class="account-option__name">{{ acc.name }}</span>
                <span class="account-option__bank" *ngIf="acc.bankName">{{ acc.bankName }}</span>
              </div>
            </div>
          </mat-option>
          }
        </mat-select>
      </div>
    </div>

    <div class="transfer-arrow">
      <mat-icon>arrow_downward</mat-icon>
    </div>

    <div class="account-selector">
      <label>Куда</label>
      <div class="selector-box">
        <mat-icon>savings</mat-icon>
        <mat-select [ngModel]="accountTo()" (ngModelChange)="accountTo.set($event)">
          @for (acc of accounts(); track acc.id) {
          <mat-option [value]="acc.name">
            <div class="account-option">
              <mat-icon class="account-option__icon">{{ acc.type === 'bank' ? 'credit_card' : 'payments' }}</mat-icon>
              <div class="account-option__info">
                <span class="account-option__name">{{ acc.name }}</span>
                <span class="account-option__bank" *ngIf="acc.bankName">{{ acc.bankName }}</span>
              </div>
            </div>
          </mat-option>
          }
        </mat-select>
      </div>
    </div>
  </div>
  }

  <!-- Standard Config (If Not Transfer) -->
  @if (type() !== 'transfer') {
  <!-- Category Grid -->
  <div class="category-grid-container">
    <div class="category-grid">
      @for (cat of categories; track cat) {
      <div class="category-item" [class.selected]="selectedCategory() === cat" (click)="selectCategory(cat)" mat-ripple>
        <div class="category-icon" [ngClass]="cat">
          <mat-icon>{{ cat | categoryIcon }}</mat-icon>
        </div>
        <span class="category-name">{{ cat }}</span>
      </div>
      }
    </div>
  </div>

  <!-- Inputs Row (Date, Account, Note) -->
  <div class="inputs-row">
    <div class="input-chip">
      <mat-icon>calendar_today</mat-icon>
      <input type="date" [ngModel]="date()" (ngModelChange)="date.set($event)" class="date-input">
    </div>

    <div class="input-chip">
      <mat-icon>account_balance_wallet</mat-icon>
      <mat-select [ngModel]="accountFrom()" (ngModelChange)="accountFrom.set($event)" class="account-select">
        @for (acc of accounts(); track acc.id) {
        <mat-option [value]="acc.name">
          <div class="account-option">
            <mat-icon class="account-option__icon">{{ acc.type === 'bank' ? 'credit_card' : 'payments' }}</mat-icon>
            <div class="account-option__info">
              <span class="account-option__name">{{ acc.name }}</span>
              <span class="account-option__bank" *ngIf="acc.bankName">{{ acc.bankName }}</span>
            </div>
          </div>
        </mat-option>
        }
      </mat-select>
    </div>

    <div class="input-chip full-width-mobile" title="Комментарий">
      <mat-icon>edit_note</mat-icon>
      <input type="text" placeholder="Комментарий..." [ngModel]="note()" (ngModelChange)="note.set($event)"
        class="note-input">
    </div>
  </div>
  }

  <div class="spacer"></div>

  <div class="actions-footer">
    <button class="save-fab" [disabled]="!canSubmit" (click)="submit()" mat-fab color="primary">
      <mat-icon>check</mat-icon>
    </button>
  </div>
</div>