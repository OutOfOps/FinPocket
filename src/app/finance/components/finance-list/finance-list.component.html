<div class="finance-view">
  <!-- Sticky Balance Header -->
  <header class="finance-header">
    <div class="finance-balance-label">Общий баланс</div>
    <div class="finance-balance-amount">
      {{ balance() | currencyFormat: defaultCurrencyCode() }}
    </div>

    <div class="finance-stats-row">
      <div class="finance-stat income">
        <mat-icon>arrow_downward</mat-icon>
        <span>{{ income() | currencyFormat: defaultCurrencyCode() }}</span>
      </div>
      <div class="finance-stat expense">
        <mat-icon>arrow_upward</mat-icon>
        <span>{{ expenses() | currencyFormat: defaultCurrencyCode() }}</span>
      </div>
    </div>

    <div class="header-actions">
      <button mat-icon-button class="action-btn" routerLink="../subscriptions" matTooltip="Подписки">
        <mat-icon>event_repeat</mat-icon>
      </button>
      <button mat-icon-button class="action-btn" routerLink="../stats" matTooltip="Статистика">
        <mat-icon>bar_chart</mat-icon>
      </button>
    </div>
  </header>

  <!-- Filter Chips (Horizontal Scroll) -->
  <div class="finance-filters">
    <mat-chip-listbox aria-label="Фильтры">
      @for (filter of filters; track filter) {
      <mat-chip-option [selected]="filter === 'Все операции'">
        {{ filter }}
      </mat-chip-option>
      }
    </mat-chip-listbox>
  </div>

  <!-- Transaction List -->
  <div class="finance-list-container">
    @if (transactions().length) {
    @for (t of transactions(); track t.id) {
    <div class="transaction-item" mat-ripple>
      <div class="transaction-icon" [ngClass]="t.category">
        <mat-icon>{{ t.category | categoryIcon }}</mat-icon>
      </div>

      <div class="transaction-content">
        <div class="transaction-main">
          <span class="transaction-category">{{ t.category }}</span>
          <span class="transaction-amount" [class.positive]="t.amount > 0" [class.negative]="t.amount < 0">
            {{ t.amount > 0 ? '+' : '' }}{{ t.convertedAmount | currencyFormat: defaultCurrencyCode() }}
          </span>
        </div>
        <div class="transaction-meta">
          <span>{{ t.description }}</span>
          <span class="dot">·</span>
          <span>{{ t.occurredAt | date:'d MMM' }}</span>
        </div>
      </div>

      <button mat-icon-button [matMenuTriggerFor]="menu" (click)="$event.stopPropagation()">
        <mat-icon>more_vert</mat-icon>
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item [routerLink]="['../', t.id, 'edit']">
          <mat-icon>edit</mat-icon>
          <span>Изменить</span>
        </button>
        <button mat-menu-item (click)="deleteTransaction(t.id)">
          <mat-icon>delete</mat-icon>
          <span>Удалить</span>
        </button>
      </mat-menu>
    </div>
    }
    } @else {
    <div class="empty-state">
      <mat-icon>account_balance_wallet</mat-icon>
      <p>Нет операций</p>
    </div>
    }
  </div>
</div>