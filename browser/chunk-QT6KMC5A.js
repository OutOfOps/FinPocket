import{a as y}from"./chunk-MBWK4RVX.js";import{a as p}from"./chunk-XXUWZJOY.js";import{A as D,J as g,Ua as c,a as d,b as m,f as a,w as l}from"./chunk-X6DWFC4Y.js";var s={credit:"\u041A\u0440\u0435\u0434\u0438\u0442",deposit:"\u0414\u0435\u043F\u043E\u0437\u0438\u0442",loan:"\u0417\u0430\u0439\u043C",lend:"\u0414\u0430\u044E \u0432 \u0437\u0430\u0439\u043C\u044B"},u={active:"\u0412 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435",paid:"\u0417\u0430\u043A\u0440\u044B\u0442",overdue:"\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D"},v=class b{storage=D(y);currencyService=D(p);debtsSignal=g([]);debts=c(()=>this.debtsSignal());listItems=c(()=>[...this.debtsSignal()].sort((t,e)=>this.sortByDueDate(t.dueDate,e.dueDate)).map(t=>{let e=this.currencyService.normalizeCode(t.currency),i=this.currencyService.convertToDefault(Math.abs(t.amount),e),r=t.kind??"loan",n=Object.hasOwn(s,r)?s[r]:s.loan,o=Object.hasOwn(u,t.status)?u[t.status]:"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E";return{id:t.id??0,name:t.contact,kind:r,kindLabel:n,status:t.status,statusLabel:o,amount:t.amount,currency:e,convertedAmount:i,dueDate:t.dueDate,participants:t.participants??[],note:t.note}}));totals=c(()=>{let t=this.currencyService.getDefaultCurrencyCode(),e=this.listItems(),i=e.filter(n=>n.kind==="credit"||n.kind==="loan").reduce((n,o)=>n+o.convertedAmount,0),r=e.filter(n=>n.kind==="deposit"||n.kind==="lend").reduce((n,o)=>n+o.convertedAmount,0);return{defaultCurrency:t,owed:i,lent:r,net:r-i}});constructor(){this.refresh()}refresh(){return a(this,null,function*(){let t=yield this.storage.getDebts();this.debtsSignal.set(t)})}addDebt(t){return a(this,null,function*(){let e=yield this.storage.addDebt(t);this.debtsSignal.update(i=>[m(d({},t),{id:e}),...i])})}updateDebt(t,e){return a(this,null,function*(){yield this.storage.updateDebt(t,e),this.debtsSignal.update(i=>i.map(r=>r.id===t?d(d({},r),e):r))})}removeDebt(t){return a(this,null,function*(){yield this.storage.deleteDebt(t),this.debtsSignal.update(e=>e.filter(i=>i.id!==t))})}getDebt(t){return this.debtsSignal().find(e=>e.id===t)}getDebtTransactions(t){return a(this,null,function*(){return this.storage.getDebtTransactions(t)})}addDebtTransaction(t,e){return a(this,null,function*(){yield this.storage.addDebtTransaction(m(d({},e),{debtId:t}))})}updateDebtTransaction(t,e){return a(this,null,function*(){yield this.storage.updateDebtTransaction(t,e)})}removeDebtTransaction(t){return a(this,null,function*(){yield this.storage.deleteDebtTransaction(t)})}kindLabel(t){return Object.hasOwn(s,t)?s[t]:s.loan}statusLabel(t){return Object.hasOwn(u,t)?u[t]:"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u043E"}sortByDueDate(t,e){return!t&&!e?0:t?e?new Date(t).getTime()-new Date(e).getTime():-1:1}static \u0275fac=function(e){return new(e||b)};static \u0275prov=l({token:b,factory:b.\u0275fac,providedIn:"root"})};export{v as a};
