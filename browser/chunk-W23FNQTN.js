import{a as Z}from"./chunk-SOO2G4HI.js";import{a as V}from"./chunk-AIYOQCO6.js";import{a as z}from"./chunk-XXUWZJOY.js";import{$b as we,A as M,Ab as te,Bb as ne,C as _,Cb as ie,D as g,Da as o,Db as re,Ea as p,Eb as ue,Fa as y,Fb as oe,Ga as j,Gb as se,H as L,Ha as he,Hb as ae,Ia as R,Ib as ce,Ja as O,Jb as le,Ka as T,Kb as me,Lb as De,Oa as Me,Ob as de,Qa as x,R as s,Ra as N,Sa as F,Ta as h,Ua as P,Y as I,Z as Q,Za as w,_a as B,_b as Pe,a as Ce,aa as d,ab as H,b as xe,bb as A,cb as X,ja as c,k as Se,ka as r,kb as Y,l as Ie,la as u,lb as Re,ma as $,mb as Oe,na as b,nb as W,oa as v,ob as Te,pb as be,qa as S,ra as E,sa as l,tb as k,vc as D,x as K,za as C,zb as ee}from"./chunk-X6DWFC4Y.js";var pe=class n{static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-meters"]],standalone:!1,decls:16,vars:0,consts:[[1,"feature-shell"],[1,"feature-shell__header"],[1,"tag-chip"],[1,"feature-shell__title"],[1,"feature-shell__subtitle"],["aria-label","\u041D\u0430\u0432\u0438\u0433\u0430\u0446\u0438\u044F \u043F\u043E \u0440\u0430\u0437\u0434\u0435\u043B\u0443",1,"feature-shell__nav"],["mat-button","","routerLink","list","routerLinkActive","feature-shell__nav-link--active"],["mat-button","","routerLink","create","routerLinkActive","feature-shell__nav-link--active"],["mat-button","","routerLink","resources","routerLinkActive","feature-shell__nav-link--active"]],template:function(e,i){e&1&&(r(0,"section",0)(1,"header",1)(2,"span",2),o(3,"\u0421\u0447\u0451\u0442\u0447\u0438\u043A\u0438"),u(),r(4,"h1",3),o(5,"\u0423\u0447\u0451\u0442 \u0432\u043E\u0434\u044B, \u0433\u0430\u0437\u0430 \u0438 \u044D\u043B\u0435\u043A\u0442\u0440\u0438\u0447\u0435\u0441\u0442\u0432\u0430"),u(),r(6,"p",4),o(7," \u041A\u043E\u043D\u0442\u0440\u043E\u043B\u0438\u0440\u0443\u0439\u0442\u0435 \u043F\u043E\u0442\u0440\u0435\u0431\u043B\u0435\u043D\u0438\u0435 \u043F\u043E \u043A\u0430\u0436\u0434\u043E\u043C\u0443 \u043E\u0431\u044A\u0435\u043A\u0442\u0443 \u0438 \u043F\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0439\u0442\u0435 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u0432 \u0441\u0440\u043E\u043A. FinPocket \u043F\u043E\u043C\u043E\u0433\u0430\u0435\u0442 \u0438\u0437\u0431\u0435\u0436\u0430\u0442\u044C \u0448\u0442\u0440\u0430\u0444\u043E\u0432 \u0438 \u043E\u043F\u0442\u0438\u043C\u0438\u0437\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u0440\u0430\u0441\u0445\u043E\u0434\u044B. "),u()(),r(8,"nav",5)(9,"a",6),o(10,"\u0421\u043F\u0438\u0441\u043E\u043A"),u(),r(11,"a",7),o(12,"\u041F\u0435\u0440\u0435\u0434\u0430\u0442\u044C \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"),u(),r(13,"a",8),o(14,"\u0420\u0435\u0441\u0443\u0440\u0441\u044B \u0438 \u0442\u0430\u0440\u0438\u0444\u044B"),u()(),$(15,"router-outlet"),u())},dependencies:[Re,W,Te,k],styles:["[_nghost-%COMP%]{display:block}.feature-shell__nav[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap;margin:1.5rem 0}.feature-shell__nav-link--active[_ngcontent-%COMP%]{background-color:#3f51b51f}"]})};var ze=n=>["../",n,"edit"],Ve=n=>["../",n];function je(n,t){if(n&1&&(b(0),o(1),v()),n&2){let e=l().$implicit,i=l(3);s(),y(" ",i.formatConsumption(e)," ")}}function Ne(n,t){if(n&1&&(b(0),o(1),v()),n&2){let e=t.ngIf;s(),p(e)}}function Le(n,t){if(n&1&&(r(0,"tr")(1,"td"),o(2),u(),r(3,"td")(4,"div",7)(5,"span"),o(6),u(),r(7,"small"),o(8),u()()(),r(9,"td"),o(10),u(),r(11,"td"),d(12,je,2,1,"ng-container",4),u(),r(13,"td"),d(14,Ne,2,1,"ng-container",4),u(),r(15,"td"),o(16),x(17,"date"),u(),r(18,"td",5)(19,"a",8),o(20,"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C"),u(),r(21,"a",9),o(22,"\u0414\u0435\u0442\u0430\u043B\u0438"),u()()()),n&2){let e=t.$implicit,i=l(3),a=C(12),m=C(14);s(2),p(e.objectName),s(4),p(e.resourceName),s(2),p(e.typeLabel),s(2),p(i.formatValues(e)),s(2),c("ngIf",e.zones.length)("ngIfElse",a),s(2),c("ngIf",i.formatCost(e))("ngIfElse",m),s(2),p(F(17,11,e.submittedAt,"d MMMM yyyy")),s(3),c("routerLink",Me(14,ze,e.id)),s(2),c("routerLink",Me(16,Ve,e.resourceId))}}function $e(n,t){if(n&1&&(r(0,"table")(1,"thead")(2,"tr")(3,"th"),o(4,"\u041E\u0431\u044A\u0435\u043A\u0442"),u(),r(5,"th"),o(6,"\u0420\u0435\u0441\u0443\u0440\u0441"),u(),r(7,"th"),o(8,"\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"),u(),r(9,"th"),o(10,"\u0420\u0430\u0441\u0445\u043E\u0434"),u(),r(11,"th"),o(12,"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C"),u(),r(13,"th"),o(14,"\u0414\u0430\u0442\u0430"),u(),r(15,"th",5),o(16,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),u()()(),r(17,"tbody"),d(18,Le,23,18,"tr",6),u()()),n&2){let e=l().ngIf,i=l();s(18),c("ngForOf",e)("ngForTrackBy",i.trackReading)}}function He(n,t){if(n&1&&(b(0),d(1,$e,19,2,"table",4),v()),n&2){let e=t.ngIf;l();let i=C(16);s(),c("ngIf",e.length)("ngIfElse",i)}}function We(n,t){n&1&&o(0,"\u2014")}function Ze(n,t){n&1&&o(0,"\u2014")}function qe(n,t){n&1&&(r(0,"p",10),o(1,"\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043F\u0435\u0440\u0432\u043E\u0435, \u0447\u0442\u043E\u0431\u044B \u043E\u0442\u0441\u043B\u0435\u0436\u0438\u0432\u0430\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F."),u())}var U=class n{store=M(V);currencyService=M(z);readings$=this.store.readingList$;defaultCurrencyCode=P(()=>this.currencyService.getDefaultCurrencyCode());trackReading(t,e){return e.id}formatConsumption(t){return t.zones.map(e=>{let i=`${e.consumption.toFixed(2).replace(/\.00$/,"")} ${t.unit}`;return`${e.label}: ${i}`}).join(" \u2022 ")}formatValues(t){return t.zones.map(e=>`${e.label}: ${e.value.toFixed(2).replace(/\.00$/,"")}`).join(" \u2022 ")}formatCost(t){return t.cost===void 0||!t.currency?null:this.currencyService.format(t.cost,t.currency)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-meters-list"]],decls:17,vars:4,consts:[["noConsumption",""],["noCost",""],["emptyState",""],[1,"meters-list"],[4,"ngIf","ngIfElse"],[1,"meters-list__actions"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"meters-list__resource"],["mat-button","","color","primary",3,"routerLink"],["mat-button","",3,"routerLink"],[1,"meters-list__empty"]],template:function(e,i){if(e&1&&(r(0,"section",3)(1,"header")(2,"h2"),o(3,"\u0423\u0447\u0451\u0442 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u0439"),u(),r(4,"p"),o(5,"\u0412\u0441\u0435 \u043E\u0431\u044A\u0435\u043A\u0442\u044B \u0438 \u0440\u0435\u0441\u0443\u0440\u0441\u044B \u0432 \u043E\u0434\u043D\u043E\u043C \u0438\u043D\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0435 \u0434\u043B\u044F \u0441\u0432\u043E\u0435\u0432\u0440\u0435\u043C\u0435\u043D\u043D\u043E\u0439 \u043F\u0435\u0440\u0435\u0434\u0430\u0447\u0438 \u0434\u0430\u043D\u043D\u044B\u0445."),u()(),r(6,"mat-card")(7,"mat-card-title"),o(8,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"),u(),d(9,He,2,2,"ng-container",4),x(10,"async"),u(),d(11,We,1,0,"ng-template",null,0,h)(13,Ze,1,0,"ng-template",null,1,h)(15,qe,2,0,"ng-template",null,2,h),u()),e&2){let a=C(16);s(9),c("ngIf",N(10,2,i.readings$))("ngIfElse",a)}},dependencies:[D,w,B,W,k,Pe,we,H,A],styles:[".meters-list[_ngcontent-%COMP%]{display:grid;gap:1.5rem}.meters-list[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.meters-list[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .meters-list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid rgba(0,0,0,.08);text-align:left}.meters-list__actions[_ngcontent-%COMP%]{text-align:right;white-space:nowrap;display:flex;justify-content:flex-end;gap:.5rem}.meters-list__resource[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.meters-list__resource[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#ffffff8f;font-size:.75rem}.meters-list__empty[_ngcontent-%COMP%]{margin:0;padding:1rem 0 0;color:#ffffffb3}"]})};function Ge(n,t){if(n&1&&$(0,"option",15),n&2){let e=t.$implicit;c("value",e.name)}}function Je(n,t){if(n&1&&(r(0,"option",15),o(1),u()),n&2){let e=t.$implicit;c("value",e.id),s(),y(" ",e.name," ")}}function Ke(n,t){if(n&1&&(r(0,"p"),o(1),x(2,"date"),u()),n&2){let e=l(2);s(),y("\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F: ",F(2,1,e.previousReadingDate,"d MMMM yyyy"))}}function Qe(n,t){if(n&1&&(b(0),o(1),x(2,"number"),v()),n&2){let e=l().$implicit,i=l(2);s(),j(" ",F(2,2,e.previous,"1.2-2")," ",i.selectedResource.unit," ")}}function Xe(n,t){if(n&1){let e=S();r(0,"article",20)(1,"label"),o(2),r(3,"input",21),E("ngModelChange",function(a){let m=_(e).$implicit,f=l(2);return g(f.updateZoneValue(m.zone.id,a))}),u()(),r(4,"dl",22)(5,"div")(6,"dt"),o(7,"\u041F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0435\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435"),u(),r(8,"dd"),d(9,Qe,3,5,"ng-container",23),u()(),r(10,"div")(11,"dt"),o(12,"\u0420\u0430\u0441\u0445\u043E\u0434 \u0437\u0430 \u043F\u0435\u0440\u0438\u043E\u0434"),u(),r(13,"dd"),o(14),x(15,"number"),u()()()()}if(n&2){let e=t.$implicit,i=l(2),a=C(27);s(2),j(" ",e.zone.name," (",i.selectedResource.unit,") "),s(),c("name","zone-"+e.zone.id)("ngModel",i.form.values[e.zone.id]),s(6),c("ngIf",e.previous!==void 0)("ngIfElse",a),s(5),j("",F(15,8,e.consumption,"1.2-2")," ",i.selectedResource.unit)}}function Ye(n,t){if(n&1&&(r(0,"section",16)(1,"header",17)(2,"h3"),o(3,"\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u043F\u043E \u0437\u043E\u043D\u0430\u043C"),u(),d(4,Ke,3,4,"p",18),u(),d(5,Xe,16,11,"article",19),u()),n&2){let e=l();s(4),c("ngIf",e.previousReadingDate),s(),c("ngForOf",e.zones)("ngForTrackBy",e.trackZone)}}function et(n,t){if(n&1&&(r(0,"li")(1,"strong"),o(2),u(),o(3),x(4,"number"),u()),n&2){let e=t.$implicit,i=l(2);s(2),y("",e.zone.name,":"),s(),j(" ",F(4,3,e.consumption,"1.2-2")," ",i.selectedResource.unit," ")}}function tt(n,t){if(n&1&&(r(0,"p"),o(1),u()),n&2){let e=l(2);s(),y(" \u0420\u0430\u0441\u0447\u0451\u0442\u043D\u0430\u044F \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C: ",e.formatCurrency(e.estimatedCost,e.estimatedCurrency)," ")}}function nt(n,t){if(n&1&&(r(0,"li")(1,"strong"),o(2),u(),o(3),r(4,"span",29),o(5),x(6,"date"),u()()),n&2){let e=t.$implicit,i=l(3);s(2),y("",i.zoneName(e.zoneId),":"),s(),y(" ",i.formatCurrency(e.price,e.currency)," "),s(2),y("\u0441 ",F(6,3,e.effectiveFrom,"d MMMM yyyy"))}}function it(n,t){if(n&1&&(r(0,"div",27)(1,"h4"),o(2,"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u044E\u0449\u0438\u0435 \u0442\u0430\u0440\u0438\u0444\u044B \u043D\u0430 \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u0443\u044E \u0434\u0430\u0442\u0443"),u(),r(3,"ul"),d(4,nt,7,6,"li",28),u()()),n&2){let e=l(2);s(4),c("ngForOf",e.activeTariffs)}}function rt(n,t){if(n&1&&(r(0,"section",24)(1,"h3"),o(2,"\u0418\u0442\u043E\u0433\u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430"),u(),r(3,"ul"),d(4,et,5,6,"li",25),u(),d(5,tt,2,1,"p",18)(6,it,5,1,"div",26),u()),n&2){let e=l();s(4),c("ngForOf",e.zones)("ngForTrackBy",e.trackZone),s(),c("ngIf",e.estimatedCost!==void 0&&e.estimatedCurrency),s(),c("ngIf",e.activeTariffs.length)}}function ut(n,t){n&1&&o(0,"\u2014")}function ot(n,t){n&1&&(r(0,"p",30),o(1," \u0414\u043B\u044F \u0432\u044B\u0431\u0440\u0430\u043D\u043D\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442 \u0440\u0435\u0441\u0443\u0440\u0441\u043E\u0432. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u0438\u0445 \u043D\u0430 \u0441\u0442\u0440\u0430\u043D\u0438\u0446\u0435 "),r(2,"a",31),o(3,"\u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043C\u0438"),u(),o(4,". "),u())}var Fe=class n{route=M(Y);router=M(Oe);store=M(V);destroyRef=M(L);currencyService=M(z);objectOptions$=this.store.objects$;isEditMode=!1;form=this.createDefaultForm();resources=[];selectedResource;activeTariffs=[];tariffHistory=[];consumption=new Map;previousValues={};estimatedCost;estimatedCurrency;previousReadingDate;defaultCurrencyCode=P(()=>this.currencyService.getDefaultCurrencyCode());constructor(){this.route.paramMap.pipe(Z(this.destroyRef)).subscribe(t=>{let e=t.get("id");this.isEditMode=!!e,e?this.patchFromExisting(e):(this.form=this.createDefaultForm(),this.updateObjectBinding(this.form.objectName),this.syncResources(),this.recalculateSummary())})}submit(){if(!this.selectedResource||!this.form.resourceId)return;let t=this.store.ensureObject(this.form.objectName),e=this.selectedResource.zones.map(a=>({zoneId:a.id,value:Number(this.form.values[a.id]??0)})),i=this.store.upsertReading({id:this.form.id,objectId:t.id,resourceId:this.form.resourceId,submittedAt:this.form.submittedAt,values:e});this.form={id:i.id,objectName:t.name,objectId:t.id,resourceId:i.resourceId,submittedAt:i.submittedAt,values:e.reduce((a,m)=>(a[m.zoneId]=m.value,a),{})},this.router.navigate(["../list"],{relativeTo:this.route})}trackObject(t,e){return e.id}trackZone(t,e){return e.zone.id}handleObjectChange(t){this.updateObjectBinding(t),this.syncResources(),this.recalculateSummary()}handleResourceChange(t){this.form.resourceId=t,this.selectedResource=this.store.getResourceById(t),this.ensureZoneValues(),this.refreshTariffs(),this.recalculateSummary()}handleDateChange(t){this.form.submittedAt=t,this.recalculateSummary()}updateZoneValue(t,e){typeof t=="string"&&Object.hasOwn(this.form.values,t)&&(this.form.values[t]=Number(e),this.recalculateSummary())}get zones(){return this.selectedResource?this.selectedResource.zones.map(t=>({zone:t,current:this.form.values[t.id]??0,previous:this.previousValues[t.id],consumption:this.consumption.get(t.id)??0})):[]}get isSubmitDisabled(){return!this.form.objectName.trim()||!this.selectedResource}zoneName(t){return this.selectedResource?t?this.selectedResource.zones.find(e=>e.id===t)?.name??t:this.selectedResource.zones.length>1?"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":this.selectedResource.zones[0]?.name??"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444"}formatCurrency(t,e,i=2){return this.currencyService.format(t,e??this.defaultCurrencyCode(),i)}updateObjectBinding(t){this.form.objectName=t;let e=this.store.getObjectByName(t);this.form.objectId=e?.id}createDefaultForm(){let t=this.store.getDefaultObjectId(),e=t?this.store.getObjectById(t):void 0,a=(t?this.store.getResourcesForObject(t).filter(m=>m.type!=="service"):[])[0];return{objectName:e?.name??"",objectId:e?.id,resourceId:a?.id,submittedAt:new Date().toISOString().substring(0,10),values:a?a.zones.reduce((m,f)=>(m[f.id]=0,m),{}):{}}}patchFromExisting(t){let e=this.store.getReadingById(t);if(!e)return;let i=this.store.getObjectById(e.objectId),a=this.store.getResourceById(e.resourceId);this.form={id:e.id,objectName:i?.name??"",objectId:e.objectId,resourceId:e.resourceId,submittedAt:e.submittedAt,values:e.values.reduce((m,f)=>(m[f.zoneId]=f.value,m),{})},this.resources=e.objectId?this.store.getResourcesForObject(e.objectId):[],this.selectedResource=a,this.ensureZoneValues(),this.refreshTariffs(),this.recalculateSummary()}ensureZoneValues(){if(!this.selectedResource){this.form.values={};return}let t={};for(let e of this.selectedResource.zones)t[e.id]=this.form.values[e.id]??0;this.form.values=t}syncResources(){if(!this.form.objectId){this.resources=[],this.selectedResource=void 0,this.form.resourceId=void 0,this.activeTariffs=[],this.tariffHistory=[];return}if(this.resources=this.store.getResourcesForObject(this.form.objectId).filter(t=>t.type!=="service"),!this.resources.length){this.selectedResource=void 0,this.form.resourceId=void 0,this.form.values={},this.activeTariffs=[],this.tariffHistory=[];return}(!this.form.resourceId||!this.resources.some(t=>t.id===this.form.resourceId))&&(this.form.resourceId=this.resources[0].id),this.selectedResource=this.store.getResourceById(this.form.resourceId??""),this.ensureZoneValues(),this.refreshTariffs()}refreshTariffs(){if(!this.selectedResource||!this.form.submittedAt){this.activeTariffs=[],this.tariffHistory=[];return}this.activeTariffs=this.store.getActiveTariffs(this.selectedResource.id,this.form.submittedAt),this.tariffHistory=this.store.getTariffHistory(this.selectedResource.id)}recalculateSummary(){if(!this.selectedResource||!this.form.resourceId){this.consumption=new Map,this.previousValues={},this.estimatedCost=void 0,this.estimatedCurrency=void 0,this.previousReadingDate=void 0;return}let t=this.selectedResource.zones.map(i=>({zoneId:i.id,value:Number(this.form.values[i.id]??0)})),e=this.store.estimatePeriodSummary(this.selectedResource.id,t,this.form.submittedAt,this.form.id);this.consumption=e.consumption,this.previousValues=e.previous?e.previous.values.reduce((i,a)=>(i[a.zoneId]=a.value,i),{}):{},this.estimatedCost=e.cost,this.estimatedCurrency=e.currency,this.previousReadingDate=e.previous?.submittedAt}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-meters-edit"]],decls:30,vars:14,consts:[["meterForm","ngForm"],["noPrevious",""],["noResourceSelected",""],[1,"meters-edit"],[1,"meters-edit__form",3,"ngSubmit"],[1,"meters-edit__grid"],["type","text","name","objectName","list","meter-objects","required","",3,"ngModelChange","ngModel"],["id","meter-objects"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["name","resourceId","required","",3,"ngModelChange","ngModel","disabled"],[3,"value",4,"ngFor","ngForOf"],["type","date","name","submittedAt","required","",3,"ngModelChange","ngModel"],["class","meters-edit__zones",4,"ngIf","ngIfElse"],["class","meters-edit__summary",4,"ngIf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"],[1,"meters-edit__zones"],[1,"meters-edit__zones-header"],[4,"ngIf"],["class","meters-edit__zone",4,"ngFor","ngForOf","ngForTrackBy"],[1,"meters-edit__zone"],["type","number","min","0","step","0.01","required","",3,"ngModelChange","name","ngModel"],[1,"meters-edit__zone-meta"],[4,"ngIf","ngIfElse"],[1,"meters-edit__summary"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","meters-edit__tariffs",4,"ngIf"],[1,"meters-edit__tariffs"],[4,"ngFor","ngForOf"],[1,"meters-edit__tariff-date"],[1,"meters-edit__empty"],["routerLink","../resources"]],template:function(e,i){if(e&1){let a=S();r(0,"section",3)(1,"header")(2,"h2"),o(3,"\u041F\u0435\u0440\u0435\u0434\u0430\u0447\u0430 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u0439"),u(),r(4,"p"),o(5," \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u043E\u0431\u044A\u0435\u043A\u0442 \u0438 \u0440\u0435\u0441\u0443\u0440\u0441, \u0441\u0440\u0430\u0432\u043D\u0438\u0442\u0435 \u0434\u0430\u043D\u043D\u044B\u0435 \u0441 \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0438\u043C \u043F\u0435\u0440\u0438\u043E\u0434\u043E\u043C \u0438 \u0441\u0440\u0430\u0437\u0443 \u0443\u0432\u0438\u0434\u0438\u0442\u0435 \u0440\u0430\u0441\u0447\u0451\u0442 \u0440\u0430\u0441\u0445\u043E\u0434\u0430 \u0438 \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C. "),u()(),r(6,"form",4,0),E("ngSubmit",function(){return _(a),g(i.submit())}),r(8,"div",5)(9,"label"),o(10," \u041E\u0431\u044A\u0435\u043A\u0442 "),r(11,"input",6),E("ngModelChange",function(f){return _(a),g(i.handleObjectChange(f))}),u(),r(12,"datalist",7),d(13,Ge,1,1,"option",8),x(14,"async"),u()(),r(15,"label"),o(16," \u0420\u0435\u0441\u0443\u0440\u0441 "),r(17,"select",9),E("ngModelChange",function(f){return _(a),g(i.handleResourceChange(f))}),d(18,Je,2,2,"option",10),u()(),r(19,"label"),o(20," \u0414\u0430\u0442\u0430 \u043F\u0435\u0440\u0435\u0434\u0430\u0447\u0438 "),r(21,"input",11),E("ngModelChange",function(f){return _(a),g(i.handleDateChange(f))}),u()()(),d(22,Ye,6,3,"section",12)(23,rt,7,4,"section",13),r(24,"button",14),o(25),u()(),d(26,ut,1,0,"ng-template",null,1,h)(28,ot,5,0,"ng-template",null,2,h),u()}if(e&2){let a=C(7),m=C(29);s(11),c("ngModel",i.form.objectName),s(2),c("ngForOf",N(14,12,i.objectOptions$))("ngForTrackBy",i.trackObject),s(4),c("ngModel",i.form.resourceId)("disabled",!i.resources.length),s(),c("ngForOf",i.resources),s(3),c("ngModel",i.form.submittedAt),s(),c("ngIf",i.selectedResource)("ngIfElse",m),s(),c("ngIf",i.selectedResource),s(),c("disabled",a.invalid||i.isSubmitDisabled),s(),y(" ",i.isEditMode?"\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F":"\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"," ")}},dependencies:[D,w,B,W,ue,ae,ce,ee,oe,se,te,ne,me,le,re,ie,k,H,X,A],styles:[".meters-edit[_ngcontent-%COMP%]{display:grid;gap:1.5rem}.meters-edit__form[_ngcontent-%COMP%]{display:grid;gap:2rem;max-width:720px}.meters-edit__grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}.meters-edit__form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;font-weight:500}.meters-edit__form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .meters-edit__form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.75rem;border:1px solid rgba(255,255,255,.08);border-radius:.75rem;background:#ffffff0a;color:inherit;font:inherit}.meters-edit__form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .meters-edit__form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#845ef799;box-shadow:0 0 0 3px #845ef733}.meters-edit__zones[_ngcontent-%COMP%]{display:grid;gap:1rem}.meters-edit__zones-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem;align-items:baseline;justify-content:space-between}.meters-edit__zones-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:#fff9;font-size:.9rem}.meters-edit__zone[_ngcontent-%COMP%]{padding:1.25rem;border-radius:1rem;border:1px solid rgba(255,255,255,.08);background:#ffffff0a;display:grid;gap:1rem}.meters-edit__zone-meta[_ngcontent-%COMP%]{display:grid;gap:.5rem;margin:0}.meters-edit__zone-meta[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1rem;font-size:.9rem;color:#ffffffbf}.meters-edit__zone-meta[_ngcontent-%COMP%]   dt[_ngcontent-%COMP%]{font-weight:500}.meters-edit__zone-meta[_ngcontent-%COMP%]   dd[_ngcontent-%COMP%]{margin:0;font-variant-numeric:tabular-nums}.meters-edit__summary[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;border:1px solid rgba(255,255,255,.08);background:#845ef714;display:grid;gap:1rem}.meters-edit__summary[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .meters-edit__tariffs[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{display:grid;gap:.5rem;margin:0;padding-left:1.25rem}.meters-edit__tariff-date[_ngcontent-%COMP%]{margin-left:.5rem;color:#fff9;font-size:.85rem}.meters-edit__empty[_ngcontent-%COMP%]{margin:0;padding:1rem;border-radius:1rem;border:1px dashed rgba(255,255,255,.16);background:#ffffff0a}.meters-edit__empty[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#b69cff;text-decoration:none}.meters-edit__empty[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]})},J=Fe;function at(n,t){if(n&1&&(r(0,"span"),o(1),u()),n&2){let e=l().ngIf;s(),y("\u0415\u0434\u0438\u043D\u0438\u0446\u0430: ",e.resource.unit)}}function ct(n,t){if(n&1&&(b(0),o(1),v()),n&2){let e=l(2).ngIf,i=l();s(),y(" ",i.formatCurrency(e.resource.fixedAmount,e.resource.fixedCurrency)," ")}}function lt(n,t){n&1&&o(0,"\u2014")}function mt(n,t){if(n&1&&(r(0,"span"),o(1," \u0421\u0443\u043C\u043C\u0430: "),d(2,ct,2,1,"ng-container",14)(3,lt,1,0,"ng-template",null,4,h),u()),n&2){let e=C(4),i=l().ngIf;s(2),c("ngIf",i.resource.fixedAmount!==void 0)("ngIfElse",e)}}function dt(n,t){if(n&1&&(b(0),r(1,"strong"),o(2),u(),v()),n&2){let e=l(2).ngIf,i=l();s(2),p(i.formatCurrency(e.resource.fixedAmount,e.resource.fixedCurrency))}}function pt(n,t){if(n&1&&(r(0,"section",15)(1,"h3"),o(2,"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u0443\u0441\u043B\u0443\u0433\u0430"),u(),r(3,"p"),o(4," \u0415\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u044B\u0439 \u043F\u043B\u0430\u0442\u0451\u0436: "),d(5,dt,3,1,"ng-container",14),u(),r(6,"p",16),o(7," \u041F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u0434\u043B\u044F \u0443\u0441\u043B\u0443\u0433\u0438 \u043D\u0435 \u0442\u0440\u0435\u0431\u0443\u044E\u0442\u0441\u044F. \u041E\u0431\u043D\u043E\u0432\u043B\u044F\u0439\u0442\u0435 \u0441\u0443\u043C\u043C\u0443 \u0432 \u0440\u0430\u0437\u0434\u0435\u043B\u0435 \u0443\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u044F \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043C\u0438. "),u()()),n&2){let e=l().ngIf;l();let i=C(4);s(5),c("ngIf",e.resource.fixedAmount!==void 0)("ngIfElse",i)}}function ft(n,t){if(n&1&&(r(0,"li")(1,"strong"),o(2),u(),o(3),r(4,"span",19),o(5),x(6,"date"),u()()),n&2){let e=t.$implicit,i=l(2).ngIf,a=l();s(2),p(i.resource.zones.length>1||e.zoneId?a.zoneName(e.zoneId):"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444"),s(),y(" \u2014 ",a.formatCurrency(e.price,e.currency)," "),s(2),y("\u0441 ",F(6,3,e.effectiveFrom,"d MMMM yyyy"))}}function _t(n,t){if(n&1&&(r(0,"section",17)(1,"h3"),o(2,"\u0410\u043A\u0442\u0443\u0430\u043B\u044C\u043D\u044B\u0435 \u0442\u0430\u0440\u0438\u0444\u044B"),u(),r(3,"ul"),d(4,ft,7,6,"li",18),u()()),n&2){let e=l().ngIf;s(4),c("ngForOf",e.currentTariffs)}}function gt(n,t){if(n&1&&(r(0,"div"),o(1),x(2,"number"),u()),n&2){let e=t.$implicit,i=l(3).ngIf;s(),he("",e.label,": ",F(2,3,e.value,"1.2-2")," ",i.resource.unit)}}function yt(n,t){if(n&1&&(b(0),o(1),x(2,"date"),v()),n&2){let e=l().$implicit;s(),p(F(2,1,e.previousAt,"d MMMM yyyy"))}}function Ct(n,t){if(n&1&&(r(0,"div"),o(1),x(2,"number"),u()),n&2){let e=t.$implicit,i=l(3).ngIf;s(),he(" ",e.label,": ",F(2,3,e.value,"1.2-2")," ",i.resource.unit," ")}}function xt(n,t){if(n&1&&(b(0),o(1),v()),n&2){let e=l().$implicit,i=l(3);s(),y(" ",i.formatCurrency(e.cost,e.currency)," ")}}function ht(n,t){n&1&&(b(0),o(1,"\u2014"),v())}function Mt(n,t){if(n&1&&(r(0,"tr")(1,"td"),o(2),x(3,"date"),u(),r(4,"td"),d(5,gt,3,6,"div",18),u(),r(6,"td"),d(7,yt,3,4,"ng-container",14),u(),r(8,"td"),d(9,Ct,3,6,"div",18),u(),r(10,"td"),d(11,xt,2,1,"ng-container",10)(12,ht,2,0,"ng-container",10),u()()),n&2){let e=t.$implicit;l(3);let i=C(8);s(2),p(F(3,7,e.submittedAt,"d MMMM yyyy")),s(3),c("ngForOf",e.values),s(2),c("ngIf",e.previousAt)("ngIfElse",i),s(2),c("ngForOf",e.consumption),s(2),c("ngIf",e.cost!==void 0&&e.currency),s(),c("ngIf",e.cost===void 0||!e.currency)}}function bt(n,t){if(n&1&&(r(0,"section",17)(1,"h3"),o(2,"\u041F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"),u(),r(3,"table")(4,"thead")(5,"tr")(6,"th"),o(7,"\u0414\u0430\u0442\u0430"),u(),r(8,"th"),o(9,"\u041F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F"),u(),r(10,"th"),o(11,"\u041F\u0440\u043E\u0448\u043B\u044B\u0439 \u0443\u0447\u0451\u0442"),u(),r(12,"th"),o(13,"\u0420\u0430\u0441\u0445\u043E\u0434"),u(),r(14,"th"),o(15,"\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C"),u()()(),r(16,"tbody"),d(17,Mt,13,10,"tr",20),u()()()),n&2){let e=l(2);s(17),c("ngForOf",e.readings)("ngForTrackBy",e.trackReading)}}function vt(n,t){if(n&1&&(r(0,"span",22),o(1),u()),n&2){let e=l().$implicit;s(),p(e.description)}}function Et(n,t){if(n&1&&(r(0,"li")(1,"strong"),o(2),u(),o(3),r(4,"span",19),o(5),x(6,"date"),u(),d(7,vt,2,1,"span",21),u()),n&2){let e=t.$implicit,i=l(3);s(2),p(i.zoneName(e.zoneId)),s(),y(" \u2014 ",i.formatCurrency(e.price,e.currency)," "),s(2),y("\u0441 ",F(6,4,e.effectiveFrom,"d MMMM yyyy")),s(2),c("ngIf",e.description)}}function Ft(n,t){if(n&1&&(r(0,"section",17)(1,"h3"),o(2,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0442\u0430\u0440\u0438\u0444\u043E\u0432"),u(),r(3,"ul"),d(4,Et,8,7,"li",18),u()()),n&2){let e=l(2);s(4),c("ngForOf",e.tariffHistory)}}function St(n,t){if(n&1&&(r(0,"section",6)(1,"header",7)(2,"div",8)(3,"mat-icon"),o(4),u(),r(5,"span")(6,"strong"),o(7),u(),r(8,"small"),o(9),u()()(),r(10,"h2"),o(11),u(),r(12,"p"),o(13),u(),r(14,"div",9),d(15,at,2,1,"span",10)(16,mt,5,2,"span",10),r(17,"span"),o(18),u()()(),d(19,pt,8,2,"section",11)(20,_t,5,1,"section",12)(21,bt,18,2,"section",13)(22,Ft,5,1,"section",12),u()),n&2){let e=t.ngIf,i=l(),a=C(6);s(4),p(i.typeIcon(e.resource.type)),s(3),p(i.typeLabel(e.resource.type)),s(2),p(i.typeDescription(e.resource.type)),s(2),p(e.resource.name),s(2),j("\u041E\u0431\u044A\u0435\u043A\u0442: ",e.object.name," \xB7 \u0423\u0447\u0451\u0442: ",i.pricingLabel(e.resource)),s(2),c("ngIf",!i.isService(e.resource)),s(),c("ngIf",i.isService(e.resource)),s(2),y("\u0417\u043E\u043D\u044B: ",i.zoneSummaryText()),s(),c("ngIf",i.isService(e.resource)),s(),c("ngIf",e.currentTariffs.length),s(),c("ngIf",!i.isService(e.resource)&&i.readings.length)("ngIfElse",a),s(),c("ngIf",i.tariffHistory.length)}}function It(n,t){n&1&&(r(0,"p",23),o(1,"\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0440\u0435\u0441\u0443\u0440\u0441 \u0432 \u0441\u043F\u0438\u0441\u043A\u0435, \u0447\u0442\u043E\u0431\u044B \u0443\u0432\u0438\u0434\u0435\u0442\u044C \u043F\u043E\u0434\u0440\u043E\u0431\u043D\u0443\u044E \u0430\u043D\u0430\u043B\u0438\u0442\u0438\u043A\u0443 \u043F\u043E\u0442\u0440\u0435\u0431\u043B\u0435\u043D\u0438\u044F."),u())}function Rt(n,t){n&1&&(r(0,"span",16),o(1,"\u2014"),u())}function Ot(n,t){n&1&&(r(0,"p",23),o(1,"\u0414\u043B\u044F \u044D\u0442\u043E\u0433\u043E \u0440\u0435\u0441\u0443\u0440\u0441\u0430 \u0435\u0449\u0451 \u043D\u0435\u0442 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u0439."),u())}function Tt(n,t){n&1&&(r(0,"p",23),o(1,"\u0414\u043B\u044F \u0443\u0441\u043B\u0443\u0433 \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F \u043D\u0435 \u0442\u0440\u0435\u0431\u0443\u044E\u0442\u0441\u044F."),u())}function Dt(n,t){if(n&1&&d(0,Ot,2,0,"p",24)(1,Tt,2,0,"p",24),n&2){let e=l();c("ngIf",!e.isService(e.summary==null?null:e.summary.resource)),s(),c("ngIf",e.isService(e.summary==null?null:e.summary.resource))}}function Pt(n,t){n&1&&o(0,"\u2014")}var G=class n{route=M(Y);store=M(V);destroyRef=M(L);currencyService=M(z);summary;readings=[];tariffHistory=[];defaultCurrencyCode=P(()=>this.currencyService.getDefaultCurrencyCode());constructor(){this.route.paramMap.pipe(Z(this.destroyRef)).subscribe(t=>{let e=t.get("id");e&&this.load(e)})}trackReading(t,e){return e.id}pricingLabel(t){if(t.type==="service")return"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u0443\u0441\u043B\u0443\u0433\u0430";switch(t.pricingModel){case"fixed":return"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u043F\u043B\u0430\u0442\u0430";case"per_unit":default:return"\u041F\u043E \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F\u043C \u0441\u0447\u0451\u0442\u0447\u0438\u043A\u0430"}}typeLabel(t){return this.store.typeLabel(t)}typeIcon(t){return this.store.typeIcon(t)}typeDescription(t){return this.store.typeDescription(t)}isService(t){return t?.type==="service"}zoneName(t){let e=this.summary?.resource;return e?t?e.zones.find(i=>i.id===t)?.name??t:e.pricingModel==="fixed"?(e.type==="service","\u0410\u0431\u043E\u043D\u0435\u043D\u0442\u0441\u043A\u0430\u044F \u043F\u043B\u0430\u0442\u0430"):e.zones.length>1?"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":e.zones[0]?.name??"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":t??"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444"}zoneSummaryText(){let t=this.summary?.resource;return t?t.type==="service"?"\u0411\u0435\u0437 \u0441\u0447\u0451\u0442\u0447\u0438\u043A\u0430":t.zones.map(e=>e.name).join(", "):"\u2014"}formatCurrency(t,e,i=2){return this.currencyService.format(t,e??this.defaultCurrencyCode(),i)}load(t){this.summary=this.store.getResourceSummary(t);let e=this.store.getResourceById(t);if(!e){this.readings=[],this.tariffHistory=[];return}if(e.type==="service"){this.readings=[],this.tariffHistory=[];return}let i=this.store.getReadingsForResource(t);this.readings=i.map(a=>{let m=this.store.estimatePeriodSummary(t,a.values,a.submittedAt,a.id);return{id:a.id,submittedAt:a.submittedAt,values:e.zones.map(f=>({label:f.name,value:this.zoneValue(a.values,f.id)})),previousAt:m.previous?.submittedAt,consumption:e.zones.map(f=>({label:f.name,value:m.consumption.get(f.id)??0})),cost:m.cost,currency:m.currency}}),this.tariffHistory=this.store.getTariffHistory(t)}zoneValue(t,e){return t.find(i=>i.zoneId===e)?.value??0}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-meters-details"]],decls:9,vars:2,consts:[["noResource",""],["noServiceAmountInline",""],["noReadings",""],["noPreviousDate",""],["noServiceAmount",""],["class","meters-details",4,"ngIf","ngIfElse"],[1,"meters-details"],[1,"meters-details__header"],[1,"meters-details__type"],[1,"meters-details__meta"],[4,"ngIf"],["class","meters-details__card meters-details__service",4,"ngIf"],["class","meters-details__card",4,"ngIf"],["class","meters-details__card",4,"ngIf","ngIfElse"],[4,"ngIf","ngIfElse"],[1,"meters-details__card","meters-details__service"],[1,"meters-details__service-note"],[1,"meters-details__card"],[4,"ngFor","ngForOf"],[1,"meters-details__tariff-date"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","meters-details__tariff-description",4,"ngIf"],[1,"meters-details__tariff-description"],[1,"meters-details__empty"],["class","meters-details__empty",4,"ngIf"]],template:function(e,i){if(e&1&&d(0,St,23,14,"section",5)(1,It,2,0,"ng-template",null,0,h)(3,Rt,2,0,"ng-template",null,1,h)(5,Dt,2,2,"ng-template",null,2,h)(7,Pt,1,0,"ng-template",null,3,h),e&2){let a=C(2);c("ngIf",i.summary)("ngIfElse",a)}},dependencies:[D,w,B,de,X,A],styles:[".meters-details[_ngcontent-%COMP%]{display:grid;gap:2rem}.meters-details__header[_ngcontent-%COMP%]{display:grid;gap:.75rem}.meters-details__header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .meters-details__meta[_ngcontent-%COMP%]{color:var(--finpocket-subtle, rgba(246, 242, 255, .72));display:flex;flex-wrap:wrap;gap:.75rem}.meters-details__type[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;gap:.75rem;align-items:center}.meters-details__type[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;font-size:26px;background:linear-gradient(140deg,color-mix(in srgb,var(--finpocket-primary) 75%,transparent),color-mix(in srgb,var(--finpocket-accent) 70%,transparent));color:var(--finpocket-text, #f6f2ff)}.meters-details__type[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.1rem}.meters-details__type[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.01em}.meters-details__type[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:.8rem;color:var(--finpocket-muted, rgba(246, 242, 255, .48))}.meters-details__card[_ngcontent-%COMP%]{padding:1.5rem;border-radius:1rem;border:1px solid var(--finpocket-border, rgba(255, 255, 255, .08));background:color-mix(in srgb,var(--finpocket-card-bg, rgba(17, 17, 17, .9)) 90%,transparent 10%);box-shadow:var(--finpocket-card-shadow, 0 12px 30px rgba(0, 0, 0, .45));display:grid;gap:1rem}.meters-details__card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0}.meters-details__card[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0;display:grid;gap:.75rem}.meters-details__card[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.meters-details__card[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .meters-details__card[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.75rem;border-bottom:1px solid color-mix(in srgb,var(--finpocket-border, rgba(255, 255, 255, .08)) 65%,transparent);text-align:left;vertical-align:top}.meters-details__card[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:.9rem}.meters-details__tariff-date[_ngcontent-%COMP%], .meters-details__tariff-description[_ngcontent-%COMP%]{margin-left:.5rem;color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.85rem}.meters-details__tariff-description[_ngcontent-%COMP%]{display:inline-block}.meters-details__empty[_ngcontent-%COMP%]{margin:0;padding:1rem;border-radius:1rem;background:color-mix(in srgb,var(--finpocket-card-bg, rgba(17, 17, 17, .9)) 88%,transparent 12%);border:1px dashed var(--finpocket-border, rgba(255, 255, 255, .14));color:var(--finpocket-subtle, rgba(246, 242, 255, .72))}.meters-details__service[_ngcontent-%COMP%]{background:color-mix(in srgb,var(--finpocket-primary, #9c27b0) 14%,transparent);border-style:dashed}.meters-details__service-note[_ngcontent-%COMP%]{margin:0;color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.9rem;line-height:1.5}"]})};function wt(n,t){if(n&1&&(b(0),o(1),v()),n&2){let e=l(2).$implicit,i=l(3);s(),y(" ",i.formatCurrency(e.fixedAmount,e.fixedCurrency)," ")}}function Bt(n,t){n&1&&o(0,"\u2014")}function At(n,t){if(n&1&&(b(0),r(1,"div",31),d(2,wt,2,1,"ng-container",24)(3,Bt,1,0,"ng-template",null,4,h),u(),r(5,"span",32),o(6),u(),v()),n&2){let e=C(4),i=l().$implicit;s(2),c("ngIf",i.fixedAmount!==void 0)("ngIfElse",e),s(4),p(i.pricingLabel)}}function kt(n,t){if(n&1&&o(0),n&2){let e=l().$implicit;p(e.pricingLabel)}}function zt(n,t){if(n&1){let e=S();r(0,"tr")(1,"td"),o(2),u(),r(3,"td"),o(4),u(),r(5,"td",27)(6,"mat-icon"),o(7),u(),r(8,"span")(9,"strong"),o(10),u(),r(11,"small"),o(12),u()()(),r(13,"td"),o(14),u(),r(15,"td",28),d(16,At,7,3,"ng-container",24)(17,kt,1,1,"ng-template",null,3,h),u(),r(19,"td",25)(20,"button",29),E("click",function(){let a=_(e).$implicit,m=l(3);return g(m.editResource(a.entity,a.objectName))}),o(21," \u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C "),u(),r(22,"button",22),E("click",function(){let a=_(e).$implicit,m=l(3);return g(m.selectForTariffs(a.entity))}),o(23,"\u0422\u0430\u0440\u0438\u0444\u044B"),u(),r(24,"button",30),E("click",function(){let a=_(e).$implicit,m=l(3);return g(m.deleteResource(a.entity))}),o(25," \u0423\u0434\u0430\u043B\u0438\u0442\u044C "),u()()()}if(n&2){let e=t.$implicit,i=C(18);s(2),p(e.objectName),s(2),p(e.entity.name),s(3),p(e.typeIcon),s(3),p(e.typeLabel),s(2),p(e.typeDescription),s(2),p(e.zoneSummary),s(2),c("ngIf",e.isService)("ngIfElse",i)}}function Vt(n,t){if(n&1&&(r(0,"table")(1,"thead")(2,"tr")(3,"th"),o(4,"\u041E\u0431\u044A\u0435\u043A\u0442"),u(),r(5,"th"),o(6,"\u0420\u0435\u0441\u0443\u0440\u0441"),u(),r(7,"th"),o(8,"\u0422\u0438\u043F"),u(),r(9,"th"),o(10,"\u0417\u043E\u043D\u044B"),u(),r(11,"th"),o(12,"\u0423\u0447\u0451\u0442"),u(),r(13,"th",25),o(14,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044F"),u()()(),r(15,"tbody"),d(16,zt,26,8,"tr",26),u()()),n&2){let e=l().ngIf,i=l();s(16),c("ngForOf",e)("ngForTrackBy",i.trackResource)}}function jt(n,t){if(n&1&&(b(0),d(1,Vt,17,2,"table",24),v()),n&2){let e=t.ngIf;l();let i=C(41);s(),c("ngIf",e.length)("ngIfElse",i)}}function Nt(n,t){if(n&1&&$(0,"option",33),n&2){let e=t.$implicit;c("value",e.name)}}function Lt(n,t){if(n&1&&(r(0,"option",33),o(1),u()),n&2){let e=t.$implicit;c("value",e.type),s(),p(e.label)}}function $t(n,t){if(n&1){let e=S();r(0,"label"),o(1," \u0415\u0434\u0438\u043D\u0438\u0446\u0430 \u0438\u0437\u043C\u0435\u0440\u0435\u043D\u0438\u044F "),r(2,"input",34),T("ngModelChange",function(a){_(e);let m=l();return O(m.resourceForm.unit,a)||(m.resourceForm.unit=a),g(a)}),u()()}if(n&2){let e=l();s(2),R("ngModel",e.resourceForm.unit)}}function Ht(n,t){if(n&1&&(r(0,"option",33),o(1),u()),n&2){let e=t.$implicit;c("value",e.value),s(),p(e.label)}}function Wt(n,t){if(n&1){let e=S();r(0,"label"),o(1," \u041C\u043E\u0434\u0435\u043B\u044C \u0440\u0430\u0441\u0447\u0451\u0442\u0430 "),r(2,"select",35),E("ngModelChange",function(a){_(e);let m=l();return g(m.onPricingModelChange(a))}),d(3,Ht,2,2,"option",18),u()()}if(n&2){let e=l();s(2),c("ngModel",e.resourceForm.pricingModel),s(),c("ngForOf",e.pricingModels)}}function Zt(n,t){if(n&1){let e=S();r(0,"label"),o(1),r(2,"input",36),T("ngModelChange",function(a){_(e);let m=l();return O(m.resourceForm.serviceAmount,a)||(m.resourceForm.serviceAmount=a),g(a)}),u()()}if(n&2){let e=l();s(),y(" \u0421\u0443\u043C\u043C\u0430, ",e.defaultCurrencyCode()," "),s(),R("ngModel",e.resourceForm.serviceAmount)}}function qt(n,t){if(n&1&&(r(0,"option",33),o(1),u()),n&2){let e=t.$implicit;c("value",e.value),s(),p(e.label)}}function Ut(n,t){if(n&1){let e=S();r(0,"label"),o(1," \u0417\u043E\u043D\u044B \u0443\u0447\u0451\u0442\u0430 "),r(2,"select",37),T("ngModelChange",function(a){_(e);let m=l();return O(m.resourceForm.zoneTemplate,a)||(m.resourceForm.zoneTemplate=a),g(a)}),d(3,qt,2,2,"option",18),u()()}if(n&2){let e=l();s(2),R("ngModel",e.resourceForm.zoneTemplate),s(),c("ngForOf",e.zoneTemplates)}}function Gt(n,t){if(n&1&&(b(0),r(1,"div",39)(2,"p"),o(3," \u0423\u0441\u043B\u0443\u0433\u0430 \u043E\u043F\u043B\u0430\u0447\u0438\u0432\u0430\u0435\u0442\u0441\u044F \u0444\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u043E\u0439 \u0441\u0443\u043C\u043C\u043E\u0439. \u0422\u0435\u043A\u0443\u0449\u0430\u044F \u0441\u0443\u043C\u043C\u0430: "),r(4,"strong"),o(5),u()(),r(6,"p",40),o(7," \u0418\u0437\u043C\u0435\u043D\u0438\u0442\u0435 \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u0432 \u0444\u043E\u0440\u043C\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u0430, \u0447\u0442\u043E\u0431\u044B \u043E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0435\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u044B\u0439 \u043F\u043B\u0430\u0442\u0451\u0436. "),u()(),v()),n&2){let e=l().ngIf,i=l();s(5),p(i.formatCurrency(e.fixedAmount??0,e.fixedCurrency))}}function Jt(n,t){if(n&1&&(r(0,"option",50),o(1),u()),n&2){let e=t.$implicit;c("ngValue",e.id),s(),p(e.label)}}function Kt(n,t){if(n&1&&(r(0,"span",55),o(1),u()),n&2){let e=l().$implicit;s(),p(e.description)}}function Qt(n,t){if(n&1){let e=S();r(0,"li")(1,"div")(2,"strong"),o(3),u(),o(4),r(5,"span",52),o(6),x(7,"date"),u(),d(8,Kt,2,1,"span",53),u(),r(9,"button",54),E("click",function(){let a=_(e).$implicit,m=l(4);return g(m.removeTariff(a))}),o(10,"\u0423\u0434\u0430\u043B\u0438\u0442\u044C"),u()()}if(n&2){let e=t.$implicit,i=l(4);s(3),p(i.zoneName(e.zoneId)),s(),y(" \u2014 ",i.formatCurrency(e.price,e.currency)," "),s(2),y("\u0441 ",F(7,4,e.effectiveFrom,"d MMMM yyyy")),s(2),c("ngIf",e.description)}}function Xt(n,t){if(n&1&&(r(0,"ul",51),d(1,Qt,11,7,"li",26),u()),n&2){let e=l(3);s(),c("ngForOf",e.tariffHistory)("ngForTrackBy",e.trackTariff)}}function Yt(n,t){if(n&1){let e=S();r(0,"form",41,6),E("ngSubmit",function(){_(e);let a=l(2);return g(a.saveTariff())}),r(2,"div",42)(3,"label"),o(4," \u0417\u043E\u043D\u0430 "),r(5,"select",43),T("ngModelChange",function(a){_(e);let m=l(2);return O(m.tariffForm.zoneId,a)||(m.tariffForm.zoneId=a),g(a)}),d(6,Jt,2,2,"option",44),u()(),r(7,"label"),o(8," \u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C "),r(9,"input",45),T("ngModelChange",function(a){_(e);let m=l(2);return O(m.tariffForm.price,a)||(m.tariffForm.price=a),g(a)}),u()(),r(10,"label"),o(11," \u0412\u0430\u043B\u044E\u0442\u0430 "),r(12,"input",46),T("ngModelChange",function(a){_(e);let m=l(2);return O(m.tariffForm.currency,a)||(m.tariffForm.currency=a),g(a)}),u()(),r(13,"label"),o(14," \u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u0441 "),r(15,"input",47),T("ngModelChange",function(a){_(e);let m=l(2);return O(m.tariffForm.effectiveFrom,a)||(m.tariffForm.effectiveFrom=a),g(a)}),u()()(),r(16,"label"),o(17," \u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 "),r(18,"input",48),T("ngModelChange",function(a){_(e);let m=l(2);return O(m.tariffForm.description,a)||(m.tariffForm.description=a),g(a)}),u()(),r(19,"div",20)(20,"button",21),o(21," \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0442\u0430\u0440\u0438\u0444 "),u()()(),r(22,"h4"),o(23,"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u0442\u0430\u0440\u0438\u0444\u043E\u0432"),u(),d(24,Xt,2,2,"ul",49)}if(n&2){let e=C(1),i=l(2),a=C(43);s(5),R("ngModel",i.tariffForm.zoneId),s(),c("ngForOf",i.zoneOptions),s(3),R("ngModel",i.tariffForm.price),s(3),R("ngModel",i.tariffForm.currency),c("placeholder",i.defaultCurrencyCode()),s(3),R("ngModel",i.tariffForm.effectiveFrom),s(3),R("ngModel",i.tariffForm.description),s(2),c("disabled",e.invalid),s(4),c("ngIf",i.tariffHistory.length)("ngIfElse",a)}}function en(n,t){if(n&1&&(r(0,"section",38)(1,"h3"),o(2),u(),d(3,Gt,8,1,"ng-container",24)(4,Yt,25,10,"ng-template",null,5,h),u()),n&2){let e=t.ngIf,i=C(5);s(2),p(e.type==="service"?"\u041F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\u044B \u0443\u0441\u043B\u0443\u0433\u0438":"\u0422\u0430\u0440\u0438\u0444\u044B: "+e.name),s(),c("ngIf",e.type==="service")("ngIfElse",i)}}function tn(n,t){n&1&&(r(0,"p",56),o(1,"\u041F\u043E\u043A\u0430 \u043D\u0435\u0442 \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u0440\u0435\u0441\u0443\u0440\u0441\u0430. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439, \u0447\u0442\u043E\u0431\u044B \u043D\u0430\u0447\u0430\u0442\u044C \u043F\u0435\u0440\u0435\u0434\u0430\u0432\u0430\u0442\u044C \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F."),u())}function nn(n,t){n&1&&(r(0,"p",56),o(1,"\u0422\u0430\u0440\u0438\u0444\u043E\u0432 \u043F\u043E\u043A\u0430 \u043D\u0435\u0442. \u0414\u043E\u0431\u0430\u0432\u044C\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439 \u0442\u0430\u0440\u0438\u0444 \u0434\u043B\u044F \u0442\u043E\u0447\u043D\u044B\u0445 \u0440\u0430\u0441\u0447\u0451\u0442\u043E\u0432."),u())}var _e=class n{store=M(V);destroyRef=M(L);currencyService=M(z);typeOptions=this.store.typeOptions;zoneTemplates=[{value:"single",label:"\u041E\u0434\u043D\u043E\u0437\u043E\u043D\u043D\u044B\u0439 \u0443\u0447\u0451\u0442"},{value:"double",label:"\u0414\u0435\u043D\u044C / \u041D\u043E\u0447\u044C"},{value:"triple",label:"\u0422\u0440\u0438 \u0437\u043E\u043D\u044B (\u043F\u0438\u043A/\u043F\u043E\u043B\u0443\u043F\u0438\u043A/\u043D\u043E\u0447\u044C)"}];pricingModels=[{value:"per_unit",label:"\u041F\u043E \u043F\u043E\u043A\u0430\u0437\u0430\u043D\u0438\u044F\u043C \u0441\u0447\u0451\u0442\u0447\u0438\u043A\u0430"},{value:"fixed",label:"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u0441\u0443\u043C\u043C\u0430 \u0432 \u043C\u0435\u0441\u044F\u0446"}];resources$=Ie([this.store.resources$,this.store.objects$]).pipe(Se(([t,e])=>this.mapToResourceView(t,e)));objectOptions$=this.store.objects$;defaultCurrencyCode=P(()=>this.currencyService.getDefaultCurrencyCode());resourceForm=this.createDefaultResourceForm();tariffForm=this.createDefaultTariffForm();selectedResourceId;tariffHistory=[];constructor(){this.store.tariffs$.pipe(Z(this.destroyRef)).subscribe(()=>{this.refreshTariffHistory()})}get selectedResource(){return this.selectedResourceId?this.store.getResourceById(this.selectedResourceId):void 0}get zoneOptions(){let t=this.selectedResource;if(!t)return[];let e=t.zones.map(i=>({id:i.id,label:i.name}));return t.pricingModel==="per_unit"&&e.unshift({id:void 0,label:"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444"}),t.pricingModel==="fixed"?[{id:void 0,label:"\u0415\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u0430\u044F \u043E\u043F\u043B\u0430\u0442\u0430"}]:e}trackResource(t,e){return e.entity.id}trackObject(t,e){return e.id}trackTariff(t,e){return e.id}selectForTariffs(t){this.selectedResourceId=t.id,this.tariffForm=xe(Ce({},this.createDefaultTariffForm()),{resourceId:t.id}),this.refreshTariffHistory()}editResource(t,e){this.resourceForm={id:t.id,objectName:e,type:t.type,name:t.name,pricingModel:t.pricingModel,zoneTemplate:this.detectTemplate(t),unit:t.unit,serviceAmount:t.fixedAmount??null},this.selectForTariffs(t)}resetResourceForm(){this.resourceForm=this.createDefaultResourceForm()}onTypeChange(t){this.resourceForm.type=t;let e=this.typeOptions.find(i=>i.type===t);e&&(this.resourceForm.unit=e.unit),t==="service"?(this.resourceForm.pricingModel="fixed",this.resourceForm.serviceAmount=this.resourceForm.serviceAmount??0):(this.resourceForm.serviceAmount=null,this.resourceForm.pricingModel==="fixed"&&(this.resourceForm.pricingModel="per_unit")),(t!=="electricity"||this.resourceForm.pricingModel==="fixed")&&(this.resourceForm.zoneTemplate="single")}onPricingModelChange(t){this.resourceForm.pricingModel=t,t==="fixed"&&(this.resourceForm.zoneTemplate="single")}saveResource(){if(!this.resourceForm.objectName.trim()||!this.resourceForm.name.trim())return;let t=this.buildZones(this.resourceForm),e={id:this.resourceForm.id,objectName:this.resourceForm.objectName,type:this.resourceForm.type,name:this.resourceForm.name,unit:this.resourceForm.unit,pricingModel:this.resourceForm.pricingModel,zones:t,fixedAmount:this.resourceForm.type==="service"?Number(this.resourceForm.serviceAmount??0):void 0,fixedCurrency:this.resourceForm.type==="service"?this.currencyService.normalizeCode(this.defaultCurrencyCode()):void 0},i=this.store.upsertResource(e);this.selectForTariffs(i),this.resourceForm=this.createDefaultResourceForm()}deleteResource(t){this.selectedResourceId===t.id&&(this.selectedResourceId=void 0,this.tariffForm=this.createDefaultTariffForm(),this.tariffHistory=[]),this.store.deleteResource(t.id)}saveTariff(){if(!this.tariffForm.resourceId)return;let t={resourceId:this.tariffForm.resourceId,zoneId:this.tariffForm.zoneId,price:Number(this.tariffForm.price),currency:this.currencyService.normalizeCode(this.tariffForm.currency),effectiveFrom:this.tariffForm.effectiveFrom,description:this.tariffForm.description?.trim()||void 0};this.store.addTariff(t),this.tariffForm=xe(Ce({},this.createDefaultTariffForm()),{resourceId:this.selectedResourceId}),this.refreshTariffHistory()}removeTariff(t){this.store.removeTariff(t.id),this.refreshTariffHistory()}typeLabel(t){return this.store.typeLabel(t)}typeIcon(t){return this.store.typeIcon(t)}zoneName(t){let e=this.selectedResource;return e?t?e.zones.find(i=>i.id===t)?.name??t:e.pricingModel==="fixed"?"\u0410\u0431\u043E\u043D\u0435\u043D\u0442\u0441\u043A\u0430\u044F \u043F\u043B\u0430\u0442\u0430":e.zones.length>1?"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":e.zones[0]?.name??"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444":t??"\u041E\u0431\u0449\u0438\u0439 \u0442\u0430\u0440\u0438\u0444"}currentTariffs(t){let e=new Date().toISOString().slice(0,10);return this.store.getActiveTariffs(t.id,e)}refreshTariffHistory(){if(!this.selectedResourceId){this.tariffHistory=[];return}this.tariffHistory=this.store.getTariffHistory(this.selectedResourceId)}mapToResourceView(t,e){return t.map(i=>{let a=e.find(ye=>ye.id===i.objectId)?.name??"\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 \u043E\u0431\u044A\u0435\u043A\u0442",m=i.type==="service",f=m?"\u0411\u0435\u0437 \u0441\u0447\u0451\u0442\u0447\u0438\u043A\u0430":i.zones.map(ye=>ye.name).join(", ")||"\u2014",ke=m?"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u0443\u0441\u043B\u0443\u0433\u0430":i.pricingModel==="fixed"?"\u0424\u0438\u043A\u0441\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u0430\u044F \u043F\u043B\u0430\u0442\u0430":`${i.zones.length} ${this.pluralizeZones(i.zones.length)}`;return{entity:i,objectName:a,typeLabel:this.store.typeLabel(i.type),typeIcon:this.store.typeIcon(i.type),typeDescription:this.store.typeDescription(i.type),isService:m,zoneSummary:f,pricingLabel:ke,fixedAmount:i.fixedAmount,fixedCurrency:i.fixedCurrency}})}detectTemplate(t){if(t.type!=="electricity")return"single";switch(t.zones.length){case 2:return"double";case 3:return"triple";default:return"single"}}buildZones(t){if(t.pricingModel==="fixed")return[{id:"fixed",name:"\u0410\u0431\u043E\u043D\u0435\u043D\u0442\u0441\u043A\u0430\u044F \u043F\u043B\u0430\u0442\u0430"}];if(t.type!=="electricity")return[{id:"total",name:"\u041E\u0431\u0449\u0438\u0439 \u0441\u0447\u0451\u0442\u0447\u0438\u043A"}];switch(t.zoneTemplate){case"double":return[{id:"day",name:"\u0414\u0435\u043D\u044C"},{id:"night",name:"\u041D\u043E\u0447\u044C"}];case"triple":return[{id:"peak",name:"\u041F\u0438\u043A"},{id:"half-peak",name:"\u041F\u043E\u043B\u0443\u043F\u0438\u043A"},{id:"night",name:"\u041D\u043E\u0447\u044C"}];default:return[{id:"total",name:"\u041E\u0431\u0449\u0438\u0439 \u0441\u0447\u0451\u0442\u0447\u0438\u043A"}]}}createDefaultResourceForm(){let t=this.typeOptions[0];return{objectName:"",type:t.type,name:"",pricingModel:"per_unit",zoneTemplate:"single",unit:t.unit,serviceAmount:null}}createDefaultTariffForm(){return{resourceId:this.selectedResourceId,zoneId:void 0,price:0,currency:this.defaultCurrencyCode(),effectiveFrom:new Date().toISOString().slice(0,10),description:""}}pluralizeZones(t){return t===1?"\u0437\u043E\u043D\u0430":t>=2&&t<=4?"\u0437\u043E\u043D\u044B":"\u0437\u043E\u043D"}formatCurrency(t,e,i=2){return this.currencyService.format(t,e??this.defaultCurrencyCode(),i)}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=I({type:n,selectors:[["app-meters-resources"]],decls:44,vars:19,consts:[["resourceFormRef","ngForm"],["emptyResources",""],["emptyTariffs",""],["meteredPricing",""],["noAmount",""],["tariffEditor",""],["tariffFormRef","ngForm"],[1,"meters-resources"],[1,"meters-resources__header"],[1,"meters-resources__layout"],[1,"meters-resources__list"],[4,"ngIf"],[1,"meters-resources__forms"],[1,"meters-resources__form",3,"ngSubmit"],["type","text","name","resourceObject","list","resource-objects","required","",3,"ngModelChange","ngModel"],["id","resource-objects"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],["name","resourceType","required","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["type","text","name","resourceName","required","",3,"ngModelChange","ngModel"],[1,"meters-resources__form-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-button","","type","button",3,"click"],["class","meters-resources__tariffs",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"meters-resources__actions"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"meters-resources__type"],[1,"meters-resources__pricing"],["mat-button","","color","primary","type","button",3,"click"],["mat-button","","color","warn","type","button",3,"click"],[1,"meters-resources__price-value"],[1,"meters-resources__price-hint"],[3,"value"],["type","text","name","resourceUnit","required","",3,"ngModelChange","ngModel"],["name","resourcePricing",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.01","name","resourceServiceAmount","required","",3,"ngModelChange","ngModel"],["name","resourceZones",3,"ngModelChange","ngModel"],[1,"meters-resources__tariffs"],[1,"meters-resources__service-card"],[1,"meters-resources__service-hint"],[1,"meters-resources__tariff-form",3,"ngSubmit"],[1,"meters-resources__tariff-grid"],["name","tariffZone",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],["type","number","min","0","step","0.01","name","tariffPrice","required","",3,"ngModelChange","ngModel"],["type","text","name","tariffCurrency","maxlength","3","required","",3,"ngModelChange","ngModel","placeholder"],["type","date","name","tariffEffective","required","",3,"ngModelChange","ngModel"],["type","text","name","tariffDescription",3,"ngModelChange","ngModel"],["class","meters-resources__tariff-history",4,"ngIf","ngIfElse"],[3,"ngValue"],[1,"meters-resources__tariff-history"],[1,"meters-resources__tariff-date"],["class","meters-resources__tariff-description",4,"ngIf"],["mat-button","","type","button","color","warn",3,"click"],[1,"meters-resources__tariff-description"],[1,"meters-resources__empty"]],template:function(e,i){if(e&1){let a=S();r(0,"section",7)(1,"header",8)(2,"h2"),o(3,"\u0423\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043C\u0438 \u0438 \u0442\u0430\u0440\u0438\u0444\u0430\u043C\u0438"),u(),r(4,"p"),o(5," \u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u0438 \u043E\u0431\u043D\u043E\u0432\u043B\u044F\u0439\u0442\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u044B \u0434\u043B\u044F \u043A\u0430\u0436\u0434\u043E\u0433\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430, \u043D\u0430\u0441\u0442\u0440\u0430\u0438\u0432\u0430\u0439\u0442\u0435 \u0441\u0445\u0435\u043C\u044B \u0443\u0447\u0451\u0442\u0430 \u0438 \u0445\u0440\u0430\u043D\u0438\u0442\u0435 \u0438\u0441\u0442\u043E\u0440\u0438\u044E \u0442\u0430\u0440\u0438\u0444\u043E\u0432 \u0434\u043B\u044F \u0442\u043E\u0447\u043D\u044B\u0445 \u0440\u0430\u0441\u0447\u0451\u0442\u043E\u0432. "),u()(),r(6,"div",9)(7,"section",10)(8,"h3"),o(9,"\u0420\u0435\u0441\u0443\u0440\u0441\u044B \u043F\u043E \u043E\u0431\u044A\u0435\u043A\u0442\u0430\u043C"),u(),d(10,jt,2,2,"ng-container",11),x(11,"async"),u(),r(12,"section",12)(13,"form",13,0),E("ngSubmit",function(){return _(a),g(i.saveResource())}),r(15,"h3"),o(16),u(),r(17,"label"),o(18," \u041E\u0431\u044A\u0435\u043A\u0442 "),r(19,"input",14),E("ngModelChange",function(f){return _(a),g(i.resourceForm.objectName=f)}),u(),r(20,"datalist",15),d(21,Nt,1,1,"option",16),x(22,"async"),u()(),r(23,"label"),o(24," \u0422\u0438\u043F \u0440\u0435\u0441\u0443\u0440\u0441\u0430 "),r(25,"select",17),E("ngModelChange",function(f){return _(a),g(i.onTypeChange(f))}),d(26,Lt,2,2,"option",18),u()(),r(27,"label"),o(28," \u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 "),r(29,"input",19),T("ngModelChange",function(f){return _(a),O(i.resourceForm.name,f)||(i.resourceForm.name=f),g(f)}),u()(),d(30,$t,3,1,"label",11)(31,Wt,4,2,"label",11)(32,Zt,3,2,"label",11)(33,Ut,4,2,"label",11),r(34,"div",20)(35,"button",21),o(36),u(),r(37,"button",22),E("click",function(){return _(a),g(i.resetResourceForm())}),o(38,"\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C"),u()()(),d(39,en,6,3,"section",23),u()(),d(40,tn,2,0,"ng-template",null,1,h)(42,nn,2,0,"ng-template",null,2,h),u()}if(e&2){let a=C(14);s(10),c("ngIf",N(11,15,i.resources$)),s(6),p(i.resourceForm.id?"\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435 \u0440\u0435\u0441\u0443\u0440\u0441\u0430":"\u041D\u043E\u0432\u044B\u0439 \u0440\u0435\u0441\u0443\u0440\u0441"),s(3),c("ngModel",i.resourceForm.objectName),s(2),c("ngForOf",N(22,17,i.objectOptions$))("ngForTrackBy",i.trackObject),s(4),c("ngModel",i.resourceForm.type),s(),c("ngForOf",i.typeOptions),s(3),R("ngModel",i.resourceForm.name),s(),c("ngIf",i.resourceForm.type!=="service"),s(),c("ngIf",i.resourceForm.type!=="service"),s(),c("ngIf",i.resourceForm.type==="service"),s(),c("ngIf",i.resourceForm.type==="electricity"&&i.resourceForm.pricingModel!=="fixed"),s(2),c("disabled",a.invalid),s(),y(" ",i.resourceForm.id?"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u0438\u0437\u043C\u0435\u043D\u0435\u043D\u0438\u044F":"\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u0440\u0435\u0441\u0443\u0440\u0441"," "),s(3),c("ngIf",i.selectedResource)}},dependencies:[D,w,B,ue,ae,ce,ee,oe,se,te,ne,me,De,le,re,ie,k,de,H,A],styles:[".meters-resources[_ngcontent-%COMP%]{display:grid;gap:2rem}.meters-resources__header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{max-width:720px;color:var(--finpocket-subtle, rgba(246, 242, 255, .72))}.meters-resources__layout[_ngcontent-%COMP%]{display:grid;gap:2rem;align-items:start;grid-template-columns:1fr}.meters-resources__list[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;border-radius:1rem;overflow:hidden;border:1px solid var(--finpocket-border, rgba(255, 255, 255, .08));background:color-mix(in srgb,var(--finpocket-card-bg, rgba(17, 17, 17, .9)) 92%,transparent 8%);box-shadow:var(--finpocket-card-shadow, 0 12px 30px rgba(0, 0, 0, .45))}.meters-resources__list[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .meters-resources__list[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.85rem 1rem;border-bottom:1px solid color-mix(in srgb,var(--finpocket-border, rgba(255, 255, 255, .08)) 65%,transparent);text-align:left;font-size:.95rem}.meters-resources__list[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background:color-mix(in srgb,var(--finpocket-primary, #9c27b0) 12%,transparent)}.meters-resources__type[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto 1fr;align-items:center;gap:.75rem}.meters-resources__type[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:32px;height:32px;border-radius:10px;display:grid;place-items:center;background:linear-gradient(140deg,color-mix(in srgb,var(--finpocket-primary) 78%,transparent),color-mix(in srgb,var(--finpocket-accent) 72%,transparent));color:var(--finpocket-text, #f6f2ff)}.meters-resources__type[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.1rem}.meters-resources__type[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.01em}.meters-resources__type[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.8rem}.meters-resources__pricing[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.35rem}.meters-resources__price-value[_ngcontent-%COMP%]{font-weight:600;letter-spacing:.01em}.meters-resources__price-hint[_ngcontent-%COMP%]{color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.8rem}.meters-resources__actions[_ngcontent-%COMP%]{white-space:nowrap;display:flex;gap:.5rem;justify-content:flex-end}.meters-resources__forms[_ngcontent-%COMP%]{display:grid;gap:2rem;align-content:start}.meters-resources__form[_ngcontent-%COMP%], .meters-resources__tariff-form[_ngcontent-%COMP%]{display:grid;gap:1rem;padding:1.5rem;border-radius:1rem;border:1px solid var(--finpocket-border, rgba(255, 255, 255, .08));background:color-mix(in srgb,var(--finpocket-card-bg, rgba(17, 17, 17, .9)) 88%,transparent 12%);box-shadow:var(--finpocket-card-shadow, 0 12px 30px rgba(0, 0, 0, .45))}.meters-resources__form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%], .meters-resources__tariff-form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;font-weight:500}.meters-resources__form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .meters-resources__form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .meters-resources__tariff-form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .meters-resources__tariff-form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.75rem;border-radius:.75rem;border:1px solid color-mix(in srgb,var(--finpocket-border, rgba(255, 255, 255, .08)) 70%,transparent);background:color-mix(in srgb,var(--finpocket-surface-alt, #1b1b22) 82%,transparent 18%);color:inherit;font:inherit}.meters-resources__tariff-grid[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}.meters-resources__form-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-start;flex-wrap:wrap}.meters-resources__tariff-history[_ngcontent-%COMP%]{display:grid;gap:.75rem;margin:0;padding:0;list-style:none}.meters-resources__tariff-history[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:1rem;padding:.75rem 1rem;border-radius:.75rem;background:color-mix(in srgb,var(--finpocket-primary, #9c27b0) 10%,var(--finpocket-card-bg, rgba(17, 17, 17, .96)) 90%)}.meters-resources__tariff-date[_ngcontent-%COMP%]{margin-left:.5rem;color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.85rem}.meters-resources__tariff-description[_ngcontent-%COMP%]{margin-left:.75rem;color:var(--finpocket-subtle, rgba(246, 242, 255, .72));font-size:.85rem}.meters-resources__empty[_ngcontent-%COMP%]{margin:0;padding:1rem;border-radius:1rem;background:color-mix(in srgb,var(--finpocket-card-bg, rgba(17, 17, 17, .9)) 88%,transparent 12%);border:1px dashed var(--finpocket-border, rgba(255, 255, 255, .14));color:var(--finpocket-subtle, rgba(246, 242, 255, .72))}.meters-resources__service-card[_ngcontent-%COMP%]{border-radius:1rem;border:1px dashed var(--finpocket-border, rgba(255, 255, 255, .14));background:color-mix(in srgb,var(--finpocket-primary, #9c27b0) 12%,transparent);padding:1.25rem;display:grid;gap:.75rem}.meters-resources__service-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.meters-resources__service-hint[_ngcontent-%COMP%]{color:var(--finpocket-muted, rgba(246, 242, 255, .48));font-size:.85rem}@media (max-width: 1024px){.meters-resources__layout[_ngcontent-%COMP%]{grid-template-columns:1fr}}"]})};var rn=[{path:"",component:pe,children:[{path:"",pathMatch:"full",redirectTo:"list"},{path:"list",component:U},{path:"create",component:J},{path:"resources",component:_e},{path:":id/edit",component:J},{path:":id",component:G}]}],ge=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Q({type:n});static \u0275inj=K({imports:[be.forChild(rn),be]})};var Ae=class n{static \u0275fac=function(e){return new(e||n)};static \u0275mod=Q({type:n});static \u0275inj=K({imports:[D,ge,U,J,G]})};export{Ae as MetersModule};
