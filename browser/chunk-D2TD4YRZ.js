import{J as u,Va as l,a as r,b as c,w as s}from"./chunk-X6DWFC4Y.js";var d=class a{storageKey="finpocket-operation-accounts";accountsSignal=u(this.loadAccounts());accounts=this.accountsSignal.asReadonly();constructor(){l(()=>{this.persistAccounts(this.accountsSignal())})}addAccount(n){let t=n.trim();!t||this.accountsSignal().map(e=>e.name.toLowerCase()).includes(t.toLowerCase())||this.accountsSignal.update(e=>[...e,{id:this.generateId(t),name:t}])}updateAccount(n,t){let i=t.trim();i&&this.accountsSignal.update(e=>e.map(o=>o.id===n?c(r({},o),{name:i}):o))}removeAccount(n){this.accountsSignal.set(this.accountsSignal().filter(t=>t.id!==n))}getSnapshot(){return{accounts:this.accountsSignal().map(n=>r({},n))}}restoreSnapshot(n){let t=Array.isArray(n.accounts)?n.accounts.map(i=>this.sanitizeAccount(i)).filter(i=>i!==null):[];this.accountsSignal.set(t)}loadAccounts(){let n=this.safeWindow();if(!n)return[];try{let t=n.localStorage.getItem(this.storageKey);if(!t)return[];let i=JSON.parse(t);return Array.isArray(i)?i.map(o=>this.sanitizeAccount(o)).filter(o=>o!==null):[]}catch{return[]}}sanitizeAccount(n){if(!n||typeof n!="object")return null;let t=n,i=typeof t.id=="string"&&t.id.trim()?t.id.trim():null,e=typeof t.name=="string"&&t.name.trim()?t.name.trim():null;return!i||!e?null:{id:i,name:e}}persistAccounts(n){let t=this.safeWindow();if(t)try{t.localStorage.setItem(this.storageKey,JSON.stringify(n))}catch{}}generateId(n){let t=n.toLowerCase().replace(/\s+/g,"-"),i=Math.random().toString(36).slice(2,8);return`account-${t}-${i}`}safeWindow(){try{return typeof window<"u"?window:null}catch{return null}}resetToDefaults(){this.accountsSignal.set([])}static \u0275fac=function(t){return new(t||a)};static \u0275prov=s({token:a,factory:a.\u0275fac,providedIn:"root"})};export{d as a};
